<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>marktplaats-notif web-interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .search {
/*            box-shadow: 0 0 2pt black;*/
            border: 2px solid black;
            border-radius: 5px;
            padding: 15px;
            margin: 15px;
        }
    </style>
</head>
<body>
<form>
    {% for search in searches %}
    <div class="search">
        <h3>{% if loop.index == 1 %} Global {% else %} {{ loop.index - 2 }} {% endif %}</h3>
        <label>
            Search query:
            <br>
            <input type="text" class="form-control" name="searches[{{ loop.index }}]" value="{{ search['query'] }}">
        </label><br><br>
        <label>
            Price from:
            <br>
            <div class="input-group">
                <span class="input-group-text"> € </span>
                <input type="number" class="form-control" name="searches[{{ loop.index }}]" value="{{ search['price_from'] }}">
            </div>
        </label><br><br>
        <label>
            Price to:
            <br>
            <div class="input-group">
                <span class="input-group-text"> € </span>
                <input type="number" class="form-control" name="searches[{{ loop.index }}]" value="{{ search['price_to'] }}">
            </div>
        </label><br><br>
        <label>
            Zip code:
            <br>
            <input type="text" class="form-control" placeholder="1234AB" name="searches[{{ loop.index }}]" value="{{ search['zip_code'] }}">
        </label><br><br>
        <label>
            Distance:
            <br>
            <div class="input-group">
               <input type="number" class="form-control" name="searches[{{ loop.index }}]" value="{{ search['distance'] }}">
               <span class="input-group-text"> km </span>
            </div>
        </label><br><br>
        <label>
            L1 category:
            <br>
            <select name="searches[{{ loop.index }}]" class="s1">
                <option value="">None</option>
                {% for category in l1_categories %}
                <option name="{{ category.name }}" {% if category.selected %} selected {% endif %}>
                    {{ category.name }}
                </option>
                {% endfor %}
            </select>
        </label><br><br>
        <label>
            L2 category:
            <br>
            <select name="searches[{{ loop.index }}]" class="s2">
                <option value="">None</option>
                {% for parent, categories in l2_categories_by_parent.items() %}
                {% for category in categories %}
                <option name="{{ category.name }}" {% if category.selected %} selected {% endif %} data-parent="{{ parent }}">
                    {{ category.name }}
                </option>
                {% endfor %}
                {% endfor %}
            </select>
        </label><br><br>
    </div>
    {% endfor %}

    <input type="submit" style="margin: 15px">
</form>
<script>
    function on_change(el) {
        const selected = el.value;
        const s2 = el.parentElement.parentElement.getElementsByClassName("s2")[0]
        for (s2_el of Array.from(s2.children).slice(1)) {
            if (s2_el.getAttribute("data-parent") === selected) {
                s2_el.removeAttribute("hidden")
            } else {
                s2_el.setAttribute("hidden", "hidden")
            }
        }
        if (s2.options[s2.selectedIndex].getAttribute("hidden")) {
            s2.value = ""
        }
    }

    for (el of document.getElementsByClassName("s1")) {
        el.addEventListener("change", (event) => {
            on_change(event.target)
        })
        on_change(el)
    }
</script>
</body>
</html>
